<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>제품 가격 & 물류 정보 계산기</title>
  <style>
    :root {
      --bg: #0f172a;        /* 전체 배경 */
      --card: #1f2937;      /* 섹션 카드 배경 */
      --border: #374151;    /* 테두리 */
      --text: #e5e7eb;      /* 기본 글자색 */
      --subtext: #9ca3af;   /* 보조 텍스트 */
      --accent: #60a5fa;    /* 포커스, 강조색 */
      --input-bg: #111827;  /* 입력창 배경 */
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      max-width: 900px;
      margin: 20px auto;
      padding: 0 16px 40px;
      background: radial-gradient(circle at top, #111827 0, #020617 60%);
      color: var(--text);
    }

    h1 {
      font-size: 22px;
      margin-bottom: 12px;
    }

    h2 {
      font-size: 18px;
      margin: 0 0 12px;
    }

    .section {
      border: 1px solid var(--border);
      background: var(--card);
      padding: 16px;
      margin-bottom: 16px;
      border-radius: 12px;
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.35);
    }

    .row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 8px;
    }

    .row label {
      width: 200px;
      font-size: 14px;
      color: var(--subtext);
      line-height: 1.4; /* 행간 확보 */
    }

    .row input {
      flex: 1;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background-color: var(--input-bg);
      color: var(--text);
      font-size: 14px;
      line-height: 1.4; /* input 내부 텍스트 행간 보정 */
    }

    .row input:focus {
      outline: 2px solid var(--accent);
      outline-offset: 1px;
      border-color: transparent;
    }

    .result {
      font-weight: 600;
      font-size: 14px;
      line-height: 1.4; /* 캡쳐 시 글자 잘림 방지 */
    }

    /* 캡쳐 버튼 스타일 */
    #capture-btn {
      margin-top: 12px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #111827;
      color: var(--text);
      font-size: 14px;
      cursor: pointer;
    }

    #capture-btn:hover {
      background: #1f2937;
    }

    #capture-btn:disabled {
      opacity: 0.5;
      cursor: default;
    }
  </style>
</head>

<body>

<h1>제품 가격 & 물류 정보 계산기 (심비오시스 내부용)</h1>

<!-- 캡쳐 대상 영역 전체를 이 div로 감싸기 -->
<div id="capture-area">

  <div class="section">
    <h2>B. 제품 가격 & 물류 정보</h2>

    <div class="row">
      <label for="productPriceYuan">제품 개당 가격 (위안)</label>
      <input type="number" id="productPriceYuan" value="0" step="0.01">
    </div>

    <div class="row">
      <label for="qtyPerBox">박스당 수량 (개)</label>
      <input type="number" id="qtyPerBox" value="0">
    </div>

    <div class="row">
      <label for="boxCount">박스 수량 (박스)</label>
      <input type="number" id="boxCount" value="0">
    </div>

    <div class="row">
      <label for="cbm">CBM (체적 m³)</label>
      <input type="number" id="cbm" value="0" step="0.0001">
    </div>

    <div class="row">
      <label for="seaFreight">해운비 (원)</label>
      <input type="number" id="seaFreight" value="0">
    </div>

    <div class="row">
      <label for="krDomestic">한국 내륙운송비 (원)</label>
      <input type="number" id="krDomestic" value="0">
    </div>

    <div class="row">
      <label for="exchangeRate">환율 (원/위안)</label>
      <input type="number" id="exchangeRate" value="200">
    </div>

    <div class="row">
      <label for="tariffRate">관세율 (%)</label>
      <input type="number" id="tariffRate" value="8">
    </div>

  </div>

  <div class="section">
    <h2>결과</h2>

    <div class="row">
      <label>총 수량 (개)</label>
      <div class="result" id="totalQty">0 개</div>
    </div>

    <div class="row">
      <label>상품 금액 합계 (원)</label>
      <div class="result" id="totalProductWon">0 원</div>
    </div>

    <div class="row">
      <label>관세 (원)</label>
      <div class="result" id="tariffWon">0 원</div>
    </div>

    <div class="row">
      <label>총 원가 (상품+관세+운송비, 원)</label>
      <div class="result" id="totalCostWon">0 원</div>
    </div>

    <div class="row">
      <label>개당 원가 (원/개)</label>
      <div class="result" id="unitCostWon">0 원</div>
    </div>
  </div>
</div>

<!-- 캡쳐 버튼 -->
<button id="capture-btn">현재 화면 캡쳐하기</button>

<!-- html2canvas 라이브러리 (CDN에서 불러옴) -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<!-- 캡쳐 기능 스크립트 -->
<script>
  const captureBtn = document.getElementById('capture-btn');

  captureBtn.addEventListener('click', async () => {
    const target = document.getElementById('capture-area');
    if (!target) return;

    captureBtn.disabled = true;
    captureBtn.textContent = '캡쳐 중...';

    try {
      // 화면을 더 선명하게 하기 위해 scale 2 배
      const canvas = await html2canvas(target, {
        scale: 2,
        useCORS: true,
        scrollY: -window.scrollY, 
        backgroundColor: '#020617'
      });

      // 클립보드 지원 여부 확인
      if (navigator.clipboard && window.ClipboardItem) {
        const blob = await new Promise(resolve =>
          canvas.toBlob(resolve, 'image/png')
        );

        await navigator.clipboard.write([
          new ClipboardItem({ 'image/png': blob })
        ]);

        captureBtn.textContent = '클립보드로 복사 완료!';
      } else {
        // 클립보드가 안 되는 브라우저에서는 다운로드로 대체
        const link = document.createElement('a');
        link.download = 'calculator_capture.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        captureBtn.textContent = '이미지 다운로드 완료!';
      }

      setTimeout(() => {
        captureBtn.textContent = '현재 화면 캡쳐하기';
      }, 1500);
    } catch (e) {
      console.error(e);
      alert('캡쳐 중 오류가 발생했습니다. (브라우저 권한/호환성 문제일 수 있어요)');
      captureBtn.textContent = '현재 화면 캡쳐하기';
    } finally {
      captureBtn.disabled = false;
    }
  });
</script>

<!-- 원가 계산 스크립트 -->
<script>
  const inputs = document.querySelectorAll("input");
  inputs.forEach(el => el.addEventListener("input", calculate));

  function valueOf(id) {
    const v = parseFloat(document.getElementById(id).value);
    return isNaN(v) ? 0 : v;
  }

  function formatWon(num) {
    return num.toLocaleString("ko-KR", { maximumFractionDigits: 2 });
  }

  function calculate() {
    const priceYuan   = valueOf("productPriceYuan");
    const qtyPerBox   = valueOf("qtyPerBox");
    const boxCount    = valueOf("boxCount");
    const cbm         = valueOf("cbm");          // 아직은 안씀 (확장용)
    const seaFreight  = valueOf("seaFreight");
    const krDomestic  = valueOf("krDomestic");
    const exchange    = valueOf("exchangeRate");
    const tariffRate  = valueOf("tariffRate") / 100;

    const totalQty = qtyPerBox * boxCount;

    // 1) 중국 상품금액(위안) → 원화
    const totalProductYuan = priceYuan * totalQty;
    const totalProductWon  = totalProductYuan * exchange;

    // 2) 관세 (예시: 상품금액 기준)
    const tariffWon = totalProductWon * tariffRate;

    // 3) 총 원가 = 상품금액 + 관세 + 운송비(해운+국내)
    const totalCostWon = totalProductWon + tariffWon + seaFreight + krDomestic;

    // 4) 개당 원가
    const unitCostWon = totalQty > 0 ? totalCostWon / totalQty : 0;

    document.getElementById("totalQty").textContent        = `${totalQty.toLocaleString("ko-KR")} 개`;
    document.getElementById("totalProductWon").textContent = `${formatWon(totalProductWon)} 원`;
    document.getElementById("tariffWon").textContent       = `${formatWon(tariffWon)} 원`;
    document.getElementById("totalCostWon").textContent    = `${formatWon(totalCostWon)} 원`;
    document.getElementById("unitCostWon").textContent     = `${formatWon(unitCostWon)} 원`;
  }

  // 초기 계산
  calculate();
</script>

</body>
</html>
